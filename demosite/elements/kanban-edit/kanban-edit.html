<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-collapse/core-collapse.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<polymer-element name="kanban-edit" attributes="storyID onClose" >
	<core-style id="x-dialog">
	  html /deep/ #editDialog::shadow #scroller {
		width: 800px;
	  }
	</core-style>
	<core-style ref="x-dialog"></core-style>
  <template>
	<style>



		paper-input {
		  width: 80%;
		}
		paper-input-decorator {
		  max-width: 80%;
		}
		paper-button[raised] {
		  background: #4285f4;
		  color: #fff;
		}
		h1 {
			clear: both;
		}
	</style>
	<paper-dialog autoCloseDisabled id="editDialog">
		<h1>Edit Story</h1>
	
		<paper-input label="Summary" floatingLabel=true value="{{story.summary}}" required></paper-input>
		<br/>
		
		<paper-input-decorator label="Description" floatingLabel>
		  <paper-autogrow-textarea>
			<textarea value="{{story.description}}"></textarea>
		  </paper-autogrow-textarea>
		</paper-input-decorator>
		
		<label>Percent Done</label>
		<br/>
		<paper-slider value={{story.percent_done}} editable></paper-slider>
		<br/>
		
		<paper-dropdown-menu>
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selected="{{story.size}}" valueattr="label">
					<template repeat="{{size in sizesResponse}}">
						<paper-item label="{{size.value}}">{{size.value}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/>
		
		<paper-dropdown-menu>
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selected="{{story.epic_id}}" valueattr="label"">
					<template repeat="{{epic in epicsResponse}}">
						<paper-item label="{{epic.id}}">{{epic.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/>
		
		<paper-dropdown-menu>
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selected="{{story.sprint_id}}" valueattr="label"">
					<template repeat="{{sprint in sprintsResponse}}">
						<paper-item label="{{sprint.id}}" >{{sprint.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<paper-dropdown-menu>
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selected="{{story.state}}" valueattr="label">
					<template repeat="{{state in statesResponse}}">
						<paper-item label="{{state.column}}" >{{state.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<paper-dropdown-menu>
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selected="{{story.status}}" valueattr="label">
					<template repeat="{{status in statusResponse}}">
						<paper-item label="{{status.id}}" >{{status.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<br/>
		<!--<p>{{story.sprint_id}}</p>
		<p>{{story.epic_id}}</p>
		<p>{{story.percent_done}}</p>
		<p>{{story.summary}}</p>
		<p>{{story.description}}</p>
		<p>{{story.size}}</p>
		<p>{{story.status}}</p>
		<p>{{story.state}}</p>-->
		
		<paper-button dismissive id="cancel" on-click="{{cancel}}">Cancel</paper-button>
		<paper-button affirmative autofocus id="save" on-click="{{save}}">Save Edits</paper-button>
		
		
	</paper-dialog>
	<!-- Get Story -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/stories.php"
			  params='{"id":"{{storyID}}"}'
			  response="{{story}}"
			  on-core-response="{{storyResponse}}"
			  handleAs="json"
			  ></core-ajax>
		
		<!-- Create Story -->
		 <core-ajax 
			id="editRequest" 
			url="http://api.kanbanboard.local/stories.php" 
			params='{"id":"{{storyID}}",
					"summary":"{{story.summary}}", 
					"sprint_id":"{{story.sprint_id}}",
					"size":"{{story.size}}",
					"description":"{{story.description}}",
					"state":"{{story.state}}",
					"percent_done":"{{story.percent_done}}",
					"status":"{{story.status}}",
					"epic_id":"{{story.epic_id}}"}'
			handleAs="json"
			method="PUT"
			on-core-response="{{editCompleted}}"
			></core-ajax>
			
		<!-- Get Status List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/status.php"
			  response="{{statusResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get Size List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/sizes.php"
			  response="{{sizesResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get Epic List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/epics.php"
			  response="{{epicsResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get User List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/users.php"
			  response="{{usersResponse}}"
			  handleAs="json"
			  ></core-ajax>
		
		<!-- Get Sprint List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/sprints.php"
			  response="{{sprintsResponse}}"
			  handleAs="json"
			  ></core-ajax>
		
		<!-- Get States List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/states.php"
			  response="{{statesResponse}}"
			  handleAs="json"
			  ></core-ajax>
  </template>
  
  <script>
    Polymer('kanban-edit',{
		ready: function() {
		},
		showDialog:function() {
			this.$.editDialog.toggle();
		},
		editCompleted: function(event, response) {
            console.log(response);
			this.$.editDialog.toggle();
			this.fire('close');
        },
		storyResponse: function(event, response) {
            console.log(response);
			
			
        },
		cancel: function(){
			this.$.editDialog.toggle();
			this.fire('close');
		},
		save: function(){
			this.$.editRequest.go();
		}
    });
	
  
  </script>
</polymer-element>