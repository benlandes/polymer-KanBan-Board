<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-collapse/core-collapse.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<polymer-element name="kanban-edit" attributes="storyID" >
  <template>
	<style>
		 :host {
		  font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
		  font-size: 14px;
		  margin: 0;
		  padding: 24px;
		  -webkit-tap-highlight-color: rgba(0,0,0,0);
		  -webkit-touch-callout: none;
		}
		paper-input {
		  width: 80%;
		}
		paper-input-decorator {
		  max-width: 80%;
		}
		paper-button[raised] {
		  background: #4285f4;
		  color: #fff;
		}
		h1 {
			clear: both;
		}
	</style>
	<p>{{storyID}}</p>
	<paper-button on-click="{{displayEdit}}" raised>Edit</paper-button>
	<paper-dialog id="editDialog">
		<h1>Edit Element</h1>
	
		<paper-input label="Summary" floatingLabel=true value="{{summary}}" required></paper-input>
		<br/>
		
		<paper-input-decorator label="Description" floatingLabel>
		  <paper-autogrow-textarea>
			<textarea value="{{description}}"></textarea>
		  </paper-autogrow-textarea>
		</paper-input-decorator>
		
		<label>Percent Done</label>
		<br/>
		<paper-slider value={{percentDone}} editable></paper-slider>
		<br/>
		
		<paper-dropdown-menu label="Select Size">
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selectedItem="{{selectedSize}}">
					<template repeat="{{size in sizesResponse}}">
						<paper-item label="{{size.value}}">{{size.value}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/>
		
		<paper-dropdown-menu label="Select Epic">
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selectedItem="{{selectedEpic}}">
					<template repeat="{{epic in epicsResponse}}">
						<paper-item label="{{epic.id}}">{{epic.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/>
		
		<paper-dropdown-menu label="Select Sprint">
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selectedItem="{{selectedSprint}}">
					<template repeat="{{sprint in sprintsResponse}}">
						<paper-item label="{{sprint.id}}" >{{sprint.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<paper-dropdown-menu label="Select State">
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selectedItem="{{selectedState}}">
					<template repeat="{{state in statesResponse}}">
						<paper-item label="{{state.column}}" >{{state.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<paper-dropdown-menu label="Select Status">
			<paper-dropdown class="dropdown">
				<core-menu class="menu" selectedItem="{{selectedStatus}}">
					<template repeat="{{status in statusResponse}}">
						<paper-item label="{{status.id}}" >{{status.name}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>
		<br/> 
		
		<br/>
		<p>{{percentDone}}</p>
		<p>{{summary}}</p>
		<p>{{description}}</p>
		<p>{{storyPoints}}</p>
		<p>{{selectedUser.attributes.label.textContent}}</p>
		<p>{{selectedStatus.attributes.label.textContent}}</p>
		<p>{{selectedSprint.attributes.label.textContent}}</p>
		<p>{{selectedState.attributes.label.textContent}}</p>
		
		
		
		<paper-button affirmative id="cancel">Cancel</paper-button>
		<paper-button affirmative autofocus id="save">Save Edits</paper-button>
		<!-- Get Story -->
		
		
		<!-- Create Story -->
		 <core-ajax 
			id="createRequest" 
			url="http://api.kanbanboard.local/stories.php" 
			params='{"summary":"{{summary}}", 
					"sprint_id":"{{selectedSprint.attributes.label.textContent}}",
					"size":"{{selectedSize.attributes.label.textContent}}",
					"description":"{{description}}",
					"state":"{{selectedState.attributes.label.textContent}}",
					"percent_done":"{{percentDone}}",
					"status":"{{selectedStatus.attributes.label.textContent}}",
					"epic_id":"{{selectedEpic.attributes.label.textContent}}"}'
			handleAs="json"
			method="POST"
			on-core-response="{{ajaxResponse}}"
			></core-ajax>
			
		<!-- Get Status List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/status.php"
			  response="{{statusResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get Size List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/sizes.php"
			  response="{{sizesResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get Epic List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/epics.php"
			  response="{{epicsResponse}}"
			  handleAs="json"
			  ></core-ajax>
			  
		<!-- Get User List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/users.php"
			  response="{{usersResponse}}"
			  handleAs="json"
			  ></core-ajax>
		
		<!-- Get Sprint List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/sprints.php"
			  response="{{sprintsResponse}}"
			  handleAs="json"
			  ></core-ajax>
		
		<!-- Get States List -->
		<core-ajax
			  auto
			  url="http://api.kanbanboard.local/states.php"
			  response="{{statesResponse}}"
			  handleAs="json"
			  ></core-ajax>
	</paper-dialog>
  </template>
  
  <script>
    Polymer('kanban-edit',{
		test:"Hello",
		ready: function() {
			//this.usersResponse = "Test";

		},
		ajaxResponse: function(event, response) {
            console.log(response);
        },
		displayEdit: function(){
			this.$.editDialog.toggle();
		},
		save: function(){
			/*var $d = this.shadowRoot.querySelectorAll('paper-input');
			Array.prototype.forEach.call($d, function(d) {
			  d.isInvalid = !d.validity.valid;
			});*/
			this.$.createRequest.go();
		}
    });
	
  
  </script>
</polymer-element>