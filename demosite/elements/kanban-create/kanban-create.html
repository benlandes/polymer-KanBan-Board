<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/core-collapse/core-collapse.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dropdown/paper-dropdown.html">

<polymer-element name="kanban-create">
  <template>
	<style>
		paper-input {
		  width: 80%;
		}
		paper-input-decorator {
		  max-width: 80%;
		}
		paper-button[raised] {
		  background: #4285f4;
		  color: #fff;
		}
	</style>
    <h1>Create Element</h1>
	
	<paper-input label="Summary" floatingLabel=true value="{{summary}}" required></paper-input>
	<br/>
	
	<paper-input-decorator label="Description" floatingLabel>
      <paper-autogrow-textarea>
        <textarea value="{{description}}"></textarea>
      </paper-autogrow-textarea>
    </paper-input-decorator>

	<paper-input label="Story Points" value="{{storyPoints}}" validate="^[0-9]+$" error="Input is not a number!" floatingLabel=true></paper-input>
	<br/>
	
	<paper-dropdown-menu label="Select Assignee">
		<paper-dropdown class="dropdown">
			<core-menu class="menu" selectedItem="{{selectedUser}}">
				<template repeat="{{user in usersResponse}}">
					<paper-item label="{{user.id}}">{{user.first_name}} {{user.last_name}}</paper-item>
				</template>
			</core-menu>
		</paper-dropdown>
	</paper-dropdown-menu>
	<br/>
	
	<paper-dropdown-menu label="Select Sprint">
		<paper-dropdown class="dropdown">
			<core-menu class="menu" selectedItem="{{selectedSprint}}">
				<template repeat="{{sprint in sprintsResponse}}">
					<paper-item label="{{sprint.id}}" >{{sprint.name}}</paper-item>
				</template>
			</core-menu>
		</paper-dropdown>
	</paper-dropdown-menu>
	<br/> 
	
	<paper-dropdown-menu label="Select State">
		<paper-dropdown class="dropdown">
			<core-menu class="menu" selectedItem="{{selectedState}}">
				<template repeat="{{state in statesResponse}}">
					<paper-item label="{{state.column}}" >{{state.name}}</paper-item>
				</template>
			</core-menu>
		</paper-dropdown>
	</paper-dropdown-menu>
	<br/> 
	<br/>
	<p>{{summary}}</p>
	<p>{{description}}</p>
	<p>{{storyPoints}}</p>
	<p>{{selectedUser.attributes.label.textContent}}</p>
	<p>{{selectedSprint.attributes.label.textContent}}</p>
	<p>{{selectedState.attributes.label.textContent}}</p>
	
	
	<paper-button on-click="{{submit}}" raised>Submit</paper-button>
	
	<!-- Create Story -->
	 <core-ajax 
		id="createRequest" 
		url="http://api.kanbanboard.local/stories.php" 
		params='{"summary":"{{summary}}", 
				"sprint_id":"{{selectedSprint.attributes.label.textContent}}",
				"story_points":"{{storyPoints}}",
				"description":"{{description}}",
				"state":"{{selectedState.attributes.label.textContent}}",
				"champion_id":"{{selectedUser.attributes.label.textContent}}"}'
		handleAs="json"
		method="POST"
		on-core-response="{{ajaxResponse}}"
		></core-ajax>
		
	<!-- Get User List -->
	<core-ajax
          auto
          url="http://api.kanbanboard.local/users.php"
          response="{{usersResponse}}"
		  handleAs="json"
          ></core-ajax>
	
	<!-- Get Sprint List -->
	<core-ajax
          auto
          url="http://api.kanbanboard.local/sprints.php"
          response="{{sprintsResponse}}"
		  handleAs="json"
          ></core-ajax>
	
	<!-- Get States List -->
	<core-ajax
          auto
          url="http://api.kanbanboard.local/states.php"
          response="{{statesResponse}}"
		  handleAs="json"
          ></core-ajax>

  </template>
  <script>
    Polymer('kanban-create',{
		test:"Hello",
		ready: function() {
			//this.usersResponse = "Test";

		},
		ajaxResponse: function(event, response) {
            console.log(response);
        },
		submit: function(){
			/*var $d = this.shadowRoot.querySelectorAll('paper-input');
			Array.prototype.forEach.call($d, function(d) {
			  d.isInvalid = !d.validity.valid;
			});*/
			this.$.createRequest.go();
		}
    });
	
  
  </script>
</polymer-element>